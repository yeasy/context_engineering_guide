## 10.4 安全性与治理

### 安全风险类型

| 风险类型 | 说明 | 影响 |
|----------|------|------|
| 提示词注入 | 恶意输入覆盖指令 | 系统被操纵 |
| 信息泄露 | 敏感信息被暴露 | 隐私/商业风险 |
| 数据污染 | 恶意内容进入知识库 | 输出质量下降 |
| 滥用攻击 | 大量请求消耗资源 | 成本/可用性 |

### 提示词注入防护

#### 输入验证

```python
def validate_input(user_input):
    # 检测可疑模式
    if contains_injection_patterns(user_input):
        raise SecurityException("疑似注入攻击")
    
    # 长度限制
    if len(user_input) > MAX_INPUT_LENGTH:
        raise ValidationError("输入过长")
```

#### 结构隔离

使用标签明确分隔：
```xml
<system_instructions>
[核心指令 - 不可覆盖]
</system_instructions>

<user_input>
[用户输入 - 可能包含恶意内容]
</user_input>
```

#### 输出过滤

检查输出是否包含敏感信息：
```python
def filter_output(response):
    if contains_sensitive(response):
        return sanitize(response)
    return response
```

### 信息安全

#### 敏感信息保护

- 系统提示词不应泄露
- 用户数据需加密
- 日志脱敏

#### 访问控制

```python
def check_access(user, resource):
    if not user.has_permission(resource):
        raise AccessDenied()
```

#### 数据分级

| 级别 | 内容 | 处理方式 |
|------|------|----------|
| 公开 | 通用知识 | 正常处理 |
| 内部 | 业务数据 | 访问控制 |
| 机密 | 敏感信息 | 加密+审计 |
| 绝密 | 核心秘密 | 禁止进入上下文 |

### 治理框架

#### 上下文资产管理

- 提示词版本控制
- 知识库来源追踪
- 配置变更审批

#### 质量门禁

```mermaid
graph LR
    A["开发"] --> B["代码审查"]
    B --> C["自动测试"]
    C --> D["安全扫描"]
    D --> E["效果评估"]
    E --> F["发布审批"]
    F --> G["生产部署"]
```

#### 审计追踪

记录关键操作：
- 配置变更
- 敏感数据访问
- 异常行为

### 合规考虑

- **数据隐私**：符合 GDPR、个保法等
- **内容安全**：过滤违规内容
- **行业规范**：特定行业的合规要求

### 应急响应

准备应急预案：
1. **发现问题**：监控告警
2. **快速止损**：降级或回滚
3. **分析原因**：深入调查
4. **彻底修复**：根本解决
5. **总结复盘**：防止再发
