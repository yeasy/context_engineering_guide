## 本章小结

本章通过 “EnterpriseKnow” 企业知识库问答系统的综合实战，把前文的四大策略（写入、选择、压缩、隔离）串成一条可落地的工程链路：从需求与架构，到知识库构建、检索与重排序、对话历史管理，再到部署与持续迭代。

### 关键概念清单

| 概念 | 定义 |
|------|------|
| 离线管道 | 文档解析、清洗、分块、向量化与索引构建 |
| 在线链路 | Query 转换、检索、重排、上下文组装与生成 |
| 混合检索 | 关键词检索与语义检索融合以提升鲁棒性 |
| 对话历史管理 | 滑动窗口 + 摘要/锚点，控制上下文膨胀 |
| 评估闭环 | 用数据集与线上反馈驱动持续优化 |

### 核心观点

1. **先架构后调参**：分清离线与在线链路，模块化后才能稳定迭代。
2. **数据质量决定上限**：解析、清洗、分块与元数据决定检索可用性。
3. **检索是“找全 + 找准”工程**：混合检索与重排序共同决定相关性。
4. **对话系统要可控**：摘要、锚点与结构化组装降低噪声与注入风险。
5. **必须可度量**：没有评估集与监控，很难判断优化是否真实有效。

### 常见误区

- **误区一**：只要接上向量库就算做完 RAG  
  **正解**：还需要 Query 转换、重排序、引用规范与失败兜底。

- **误区二**：多轮对话就把历史都拼接  
  **正解**：要分层管理历史（窗口、摘要、锚点、外存）。

- **误区三**：上线后再考虑评估与监控  
  **正解**：评估数据集与可观测性应在早期就纳入工作流。

### 实践建议

1. **从最小可用链路开始**：先跑通离线建库 + 在线检索 + 引用回答。
2. **把失败样例当资产**：把 Bad Case 归因到分块/检索/提示词/数据源并固化。
3. **为成本做预算**：对检索 Top-K、重排序 K、输出长度设定默认预算。
4. **按场景压测**：在真实请求分布下评估延迟、成本与效果。

### 预告

下一章将展望上下文工程的未来趋势，并给出持续学习与成长路径。
