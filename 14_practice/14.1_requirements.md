# 14.1 项目需求与架构设计

在开始编码之前，清晰的需求分析和稳健的架构设计是成功的关键。

## 1. 需求分析

### 1.1 核心功能需求
*   **多源数据接入**：支持导入 PDF、Markdown、Word 等格式的企业文档。
*   **精准问答**：基于知识库回答用户提问，回答需标注引用来源。
*   **多轮对话**：支持基于上下文的追问，理解指代关系（如"它"、"这个"）。
*   **拒识能力**：对于知识库中不存在的问题，应明确告知"未找到相关信息"，避免幻觉。

### 1.2 非功能需求
*   **响应速度**：首字生成延迟 < 1秒，完整回答 < 5秒。
*   **并发能力**：支持至少 50 QPS 的并发访问。
*   **数据安全**：确保企业敏感数据不泄露，支持私有化部署模型。

## 2. 技术选型

| 组件 | 选型 | 理由 |
| :--- | :--- | :--- |
| **LLM** | DeepSeek-V3 / Qwen-2.5-72B | 性价比高，中文能力强，支持长上下文 |
| **Embedding** | BGE-M3 | 多语言支持好，支持长文本嵌入 |
| **Vector DB** | Milvus / Qdrant | 高性能，易于扩展，生态成熟 |
| **Orchestration** | LangChain / LlamaIndex | 快速构建 RAG 流程，组件丰富 |
| **Backend** | FastAPI (Python) | 高性能异步框架，适合 AI 应用后端 |

## 3. 系统架构设计

系统整体采用典型的 RAG（检索增强生成）架构，分为**离线处理链路**和**在线服务链路**。

### 3.1 架构图

```mermaid
graph TD
    subgraph "离线处理 (Offline Pipeline)"
        D[原始文档] --> P[文档解析 (Parser)]
        P --> C[分块 (Chunking)]
        C --> E[向量化 (Embedding)]
        E --> V[(向量数据库)]
    end

    subgraph "在线服务 (Online Service)"
        U[用户提问] --> Q[查询重写 (Query Rewrite)]
        Q --> R[混合检索 (Hybrid Search)]
        V --> R
        R --> RK[重排序 (Rerank)]
        RK --> G[上下文组装 (Prompt)]
        His[对话历史] --> G
        G --> L[LLM 生成]
        L --> Ans[最终回答]
    end
```

### 3.2 模块职责
1.  **数据层**：负责文档的 ETL（Extract, Transform, Load）。
2.  **检索层**：负责根据语义和关键词召回相关片段，并进行精排。
3.  **认知层**：负责对话状态管理、Prompt 组装和 LLM 推理。
4.  **接口层**：提供标准 API 供前端或第三方系统调用。
